# cpp-in-action

课程源码：https://github.com/chronolaw/cpp_study

工程化工具推荐：
- cmake
- scons

多看些开源项目：

- Nginx
- LevelDB
- Folly


> 建议现在从C++11/14开始学起，太早的C++98和太新的C++17/20都不要看，不要一味追新。
>
>11/14已经很“现代”了，可以写出媲美Java、Python的优雅代码，学习难度也低了很多，编译器的支持也是最好的。

## 编译指令

```c++
g++ xxx.cpp -std=c++14 -o a.out
```

## 概论

### 生命周期

- 编码（Coding）

- 预处理（Pre-processing）

所谓的预处理，其实是相对于下一个阶段“编译”而言的，在编译之前，预先处理一下源代码，既有点像是编码，又有点像是编译，是一个中间阶段。

在这个阶段，发挥作用的是预处理器（Pre-processor）。它的输入是编码阶段产生的源码文件，输出是经过“预处理”的源码文件。“预处理”的目的是文字替换，用到的就是我们熟悉的各种预处理指令，比如 #include、#define、#if 等，实现“预处理编程”。

- 编译（Compiling）

在预处理之后，C++ 程序就进入了编译阶段，更准确地说，应该是“编译”和“链接（Linking）”。简单起见，我统一称之为“编译”。

在编译阶段，C++ 程序——也就是经过预处理的源码——要经过编译器和链接器的“锤炼”，生成可以在计算机上运行的二进制机器码。这里面的讲究是最多的，也是最复杂的，C++ 编译器要分词、语法解析、生成目标码，并尽可能地去优化。

在编译的过程中，编译器还会根据 C++ 语言规则检查程序的语法、语义是否正确，发现错误就会产生“编译失败”。这就是最基本的 C++“静态检查”。

在处理源码时，由于编译器是依据 C++ 语法检查各种类型、函数的定义，所以，在这个阶段，我们就能够以编译器为目标进行编程，有意识地控制编译器的行为。这里有个新名词，叫“模板元编程”。

- 运行（Running）

编译阶段之后，有了可执行文件，C++ 程序就可以跑起来了，进入运行阶段。这个时候，“静态的程序”被载入内存，由 CPU 逐条语句执行，就形成了“动态的进程”。

运行阶段也是我们最熟悉的了。在这个阶段，我们常做的是 GDB 调试、日志追踪、性能分析等，然后收集动态的数据、调整设计思路，再返回编码阶段，重走这个“瀑布模型”，实现“螺旋上升式”的开发。

### 编程范式（Paradigm）

**“编程范式”是一种“方法论”，就是指导你编写代码的一些思路、规则、习惯、定式和常用语。**

C++ 是一种多范式的编程语言。具体来说，现代 C++（11/14 以后）支持“面向过程”“面向对象”“泛型”“模板元”“函数式”这五种主要的编程范式。
其中，“面向过程”“面向对象”是基础，支撑着后三种范式。

- 面向过程是 C++ 里最基本的一种编程范式。它的核心思想是“命令”，通常就是顺序执行的语句、子程序（函数），把任务分解成若干个步骤去执行，最终达成目标。

- 面向对象是 C++ 里另一个基本的编程范式。它的核心思想是“抽象”和“封装”，倡导的是把任务分解成一些高内聚低耦合的对象，这些对象互相通信协作来完成任务。它强调对象之间的关系和接口，而不是完成任务的具体步骤。

- 泛型编程是自 STL（标准模板库）纳入到 C++ 标准以后才逐渐流行起来的新范式，核心思想是“一切皆为类型”，或者说是“参数化类型”“类型擦除”，使用模板而不是继承的方式来复用代码，所以运行效率更高，代码也更简洁。

- 与“泛型编程”很类似的是模板元编程。它的核心思想是“类型运算”，操作的数据是编译时可见的“类型”，所以也比较特殊，代码只能由编译器执行，而不能被运行时的 CPU 执行。
    > 在 C++ 里，泛型的基础就是 template 关键字，然后是庞大而复杂的标准库，里面有各种泛型容器和算法，比如 vector、map、sort，等等。

- 函数式，它几乎和“面向过程”一样古老，但却直到近些年才走入主流编程界的视野。所谓的“函数式”并不是 C++ 里写成函数的子程序，而是数学意义上、无副作用的函数，核心思想是“一切皆可调用”，通过一系列连续或者嵌套的函数调用实现对数据的处理。

> 要认识、理解这些范式的优势和劣势，在程序里适当混用，取长补短才是“王道”。
> 拿我自己来说，我的出发点是“尽量让周围的人都能看懂代码”，所以常用的范式是“过程 + 对象 + 泛型”，再加上少量的“函数式”，慎用“模板元”。

> 我个人觉得，面向过程和面向对象是最基本的范式，是 C++ 的基础，无论如何都是必须要掌握的，而后三种范式的学习难度就大一些。
> 如果是开发直接面对用户的普通应用（Application），那么你可以再研究一下“泛型”和“函数式”，就基本可以解决 90% 的开发问题了；如果是开发面向程序员的库（Library），那么你就有必要深入了解“泛型”和“模板元”，优化库的接口和运行效率。


> ! 在 C++ 里可以“无缝”混用多范式编程，但因为范式的差异比较大，必须小心谨慎，避免导致混乱。

### 面向对象和基于对象有什么区别？

这两个广义上都属于面向对象，严格来说也算是有区别。

前者强调统一用对象建模，多应用设计模式，对象关系复杂。

而后者则相当于C with class，只把class当成struct来封装数据，继承、多态等高级特性用的比较少。

> 现在C++里面向对象不是主流了，泛型、函数式各种范式混合着来才有意思。